<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lobby-Übersicht</title>
    <script src="mainscreen.js" defer></script>
    <link rel="stylesheet" href="mainscreen.css" />
</head>
<body>
    <h1>Lobby</h1>
    <h2 id="pinAnzeige">PIN: </h2>
    <div id="spielerListe">Spieler werden geladen...</div>
    <button id="startButton">Spiel starten</button>
    <button id="spielBeendenBtn">Spiel beenden</button>
    <button id="gameAuswahlBtn" style="display:none; margin:2rem auto 0 auto; padding:1rem 2rem; font-size:1.1rem; background:#ff6ec4; color:#fff; border:none; border-radius:8px; cursor:pointer;">Nächstes Spiel auswählen</button>
    <!-- Popup für Spielauswahl -->
    <div id="popupOverlay">
        <div id="popupMenu">
            <h2>Nächstes Spiel auswählen</h2>
            <div class="game-grid" id="gameGrid">
                <!-- Spielkarten werden per JS eingefügt -->
            </div>
            <button id="spielSetzenBtn" disabled>Spiel setzen</button>
            <div id="auswahlStatus"></div>
        </div>
    </div>
    <script>
        // ...existing code...
        const gameAuswahlBtn = document.getElementById("gameAuswahlBtn");
        const startButton = document.getElementById("startButton");
        // ...existing code...

        // Button nur anzeigen, wenn das Spiel gestartet wurde
        async function pruefeObGameGestartetUndButton() {
            try {
                const response = await fetch(`https://kk-backend.vercel.app/gehtsLos?lobby=${pin}`);
                const spielGestartet = await response.json();
                if (spielGestartet) {
                    gameAuswahlBtn.style.display = "block";
                } else {
                    gameAuswahlBtn.style.display = "none";
                }
            } catch (err) {
                gameAuswahlBtn.style.display = "none";
            }
        }

        // Popup immer öffnen können, wenn Button sichtbar
        gameAuswahlBtn.addEventListener("click", () => {
            popupOverlay.style.display = "flex";
            auswahlStatus.textContent = "";
            selectedGameId = null;
            spielSetzenBtn.disabled = true;
            document.querySelectorAll('.game-card').forEach(c => c.classList.remove('selected'));
        });

        // Starte Polling für Button-Anzeige
        setInterval(pruefeObGameGestartetUndButton, 1000);

        // ...existing code...
    </script>
</body>
</html>